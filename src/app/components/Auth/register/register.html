<div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
  <div class="card shadow-sm p-4" style="width: 100%; max-width: 450px;">
    <h2 class="text-center mb-4">üìù Register</h2>

    <div *ngIf="successMessage" class="alert alert-success mb-3" role="alert">
      {{ successMessage }}
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger mb-3" role="alert">
      {{ errorMessage }}
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>
      <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" formControlName="email" class="form-control"
          [ngClass]="{ 'is-invalid': (submitted || registerForm.get('email')?.touched) && registerForm.get('email')?.invalid }" />
        <div *ngIf="(submitted || registerForm.get('email')?.touched) && registerForm.get('email')?.invalid" class="invalid-feedback">
          <div *ngIf="registerForm.get('email')?.errors?.['required']">Email is required.</div>
          <div *ngIf="registerForm.get('email')?.errors?.['email']">Invalid email format.</div>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" formControlName="name" class="form-control"
          [ngClass]="{ 'is-invalid': (submitted || registerForm.get('name')?.touched) && registerForm.get('name')?.invalid }" />
        <div *ngIf="(submitted || registerForm.get('name')?.touched) && registerForm.get('name')?.invalid" class="invalid-feedback">
          Name is required.
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Password</label>
        <div class="input-group">
          <input [type]="showPassword ? 'text' : 'password'" formControlName="password" class="form-control"
            [ngClass]="{ 'is-invalid': (submitted || registerForm.get('password')?.touched) && registerForm.get('password')?.invalid }" />
          <button type="button" class="btn btn-outline-secondary" (click)="showPassword = !showPassword">
            {{ showPassword ? 'Hide' : 'Show' }}
          </button>
        </div>
        <div *ngIf="(submitted || registerForm.get('password')?.touched) && registerForm.get('password')?.invalid" class="invalid-feedback d-block">
          <div *ngIf="registerForm.get('password')?.errors?.['required']">Password is required.</div>
          <div *ngIf="registerForm.get('password')?.errors?.['minlength']">Min 6 characters required.</div>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Confirm Password</label>
        <div class="input-group">
          <input [type]="showPassword ? 'text' : 'password'" formControlName="confirmPassword" class="form-control"
            [ngClass]="{ 'is-invalid': (submitted || registerForm.get('confirmPassword')?.touched) && (registerForm.get('confirmPassword')?.invalid || registerForm.hasError('mismatch')) }" />
          <button type="button" class="btn btn-outline-secondary" (click)="showPassword = !showPassword">
            {{ showPassword ? 'Hide' : 'Show' }}
          </button>
        </div>
        <div *ngIf="(submitted || registerForm.get('confirmPassword')?.touched) && (registerForm.get('confirmPassword')?.invalid || registerForm.hasError('mismatch'))" class="invalid-feedback d-block">
          <div *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">Confirm Password is required.</div>
          <div *ngIf="registerForm.hasError('mismatch')">Passwords do not match.</div>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Role</label>
        <select formControlName="role" class="form-select"
          [ngClass]="{ 'is-invalid': (submitted || registerForm.get('role')?.touched) && registerForm.get('role')?.invalid }">
          <option value="" disabled>Select role</option>
          <option value="admin">Admin</option>
          <option value="farmer">Farmer</option>
        </select>
        <div *ngIf="(submitted || registerForm.get('role')?.touched) && registerForm.get('role')?.invalid" class="invalid-feedback">
          Role is required.
        </div>
      </div> 

      <div class="mb-3">
        <label class="form-label">Phone Number</label>
        <input type="text" formControlName="phoneNumber" class="form-control"
          [ngClass]="{ 'is-invalid': (submitted || registerForm.get('phoneNumber')?.touched) && registerForm.get('phoneNumber')?.invalid }" />
        <div *ngIf="(submitted || registerForm.get('phoneNumber')?.touched) && registerForm.get('phoneNumber')?.invalid" class="invalid-feedback">
          Phone number is required.
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Address</label>
        <input type="text" formControlName="address" class="form-control"
          [ngClass]="{ 'is-invalid': (submitted || registerForm.get('address')?.touched) && registerForm.get('address')?.invalid }" />
        <div *ngIf="(submitted || registerForm.get('address')?.touched) && registerForm.get('address')?.invalid" class="invalid-feedback">
          Address is required.
        </div>
      </div>

      <div class="d-grid">
        <button type="submit" class="btn btn-success" [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          Register
        </button>
      </div>
    </form>

    <p class="text-center mt-3">
      Already have an account?
      <a routerLink="/login">Login</a>
    </p>
  </div>
</div>